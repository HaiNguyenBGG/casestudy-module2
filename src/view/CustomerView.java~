package view;

import facade.StoreFacade;
import model.Customer;
import java.util.List;
import java.util.Scanner;

public class CustomerView {
    private final StoreFacade storeFacade = StoreFacade.getInstance();
    private final Scanner scanner = new Scanner(System.in);

    public void showMenu() {
        while (true) {
            System.out.println("\n===== Qu·∫£n l√Ω Kh√°ch H√†ng =====");
            System.out.println("1. Th√™m kh√°ch h√†ng");
            System.out.println("2. X√≥a kh√°ch h√†ng");
            System.out.println("3. Hi·ªÉn th·ªã danh s√°ch kh√°ch h√†ng");
            System.out.println("0. Quay l·∫°i");
            System.out.print("Ch·ªçn ch·ª©c nƒÉng: ");

            int choice = getIntInput();
            switch (choice) {
                case 1 -> addCustomer();
                case 2 -> removeCustomer();
                case 3 -> displayCustomers();
                case 0 -> {
                    System.out.println("üëã Tho√°t ch∆∞∆°ng tr√¨nh.");
                    return;
                }
                default -> System.out.println("‚ùå L·ª±a ch·ªçn kh√¥ng h·ª£p l·ªá! Vui l√≤ng nh·∫≠p l·∫°i.");
            }
        }
    }

    private void addCustomer() {
        int id;
        String name, email, phone;

        while (true) {
            System.out.print("Nh·∫≠p ID: ");
            id = getIntInput();
            if (!storeFacade.customerExists(id)) {
                break;
            }
            System.out.println("‚ùå ID ƒë√£ t·ªìn t·∫°i! Vui l√≤ng nh·∫≠p ID kh√°c.");
        }

        System.out.print("Nh·∫≠p t√™n: ");
        name = scanner.nextLine();

        System.out.print("Nh·∫≠p email: ");
        email = scanner.nextLine();

        System.out.print("Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i: ");
        phone = scanner.nextLine();

        String result = storeFacade.addCustomer(id, name, email, phone);
        System.out.println(result);
    }

    private void removeCustomer() {
        int id;
        while (true) {
            System.out.print("Nh·∫≠p ID kh√°ch h√†ng c·∫ßn x√≥a: ");
            id = getIntInput();

            if (storeFacade.customerExists(id)) {
                break;
            }
            System.out.println("‚ùå Kh√¥ng t√¨m th·∫•y kh√°ch h√†ng c√≥ ID: " + id + ". Vui l√≤ng nh·∫≠p l·∫°i.");
        }

        System.out.print("B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a kh√°ch h√†ng n√†y? (Y/N): ");
        String confirm = scanner.nextLine().trim().toLowerCase();
        if (confirm.equals("y")) {
            String result = storeFacade.removeCustomer(id);
            System.out.println(result);
        } else {
            System.out.println("‚ùå H·ªßy x√≥a kh√°ch h√†ng.");
        }
    }

    private void displayCustomers() {
        List<Customer> customers = storeFacade.getAllCustomers();
        if (customers.isEmpty()) {
            System.out.println("‚ùå Kh√¥ng c√≥ kh√°ch h√†ng n√†o trong h·ªá th·ªëng.");
        } else {
            System.out.println("\nüìã Danh s√°ch kh√°ch h√†ng:");
            customers.forEach(System.out::println);
        }
    }

    private int getIntInput() {
        while (true) {
            try {
                return Integer.parseInt(scanner.nextLine().trim());
            } catch (NumberFormatException e) {
                System.out.print("‚ùå L·ªói: Vui l√≤ng nh·∫≠p s·ªë nguy√™n h·ª£p l·ªá: ");
            }
        }
    }
}
